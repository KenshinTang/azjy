<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Cache-Control" content="public" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-status-bar-style"  content="black" />
  <meta name="renderer" content="webkit">
  <meta name="description" content="All About Children">
  <meta name="keywords" content="All About Children">
  <link rel="stylesheet" href="mui/css/mui.min.css">
  <link rel="stylesheet" href="inc/g.css" type="text/css">
  <link rel="stylesheet" href="css/common.css" type="text/css">
  <link rel="stylesheet" href="css/unique.css" type="text/css">
  <script src="js/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="js/common.js"></script>
  <style>
    .home-6-l{
      padding:15px;
    }
    .myCourse-1{
      padding: 15px 0px 0px 0px;
    }
    .myCourse-3 {
      width: 6px;
      height: 6px;
      float: left;
      margin: 0px 6px;
      margin-top: 7px;
    }
  </style>
</head>
<body>
<header>
  <div class="back1" onclick="Comm.close();"></div>
  <div class="menu1 hide"></div>
  <div class="titlebar hide">Institution</div>
</header>

<section class="pre">
  <div id="refreshContainer" class="mui-content mui-scroll-wrapper hide">
    <div class="mui-scroll">
      <!--数据列表-->
      <ul class="mui-table-view mui-table-view-chevron" id="listView">

        <div class="institutions-l">
          <!--<div class="institutions-l-1 pre">-->
          <!--<img src="images/test/goods3.png" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;">-->
          <!--<div class="institutions-l-1-1">Here</div>-->
          <!--</div>-->
          <!--<div class="institutions-l-2">Here is the name of the organization</div>-->
          <!--<div class="institutions-l-3 row2">We have not reviewed, and cannot review, all of the material, including computer software including computer</div>-->
          <!--<div class="institutions-l-4 ovf">-->
          <!--<div class="left home-6-l-c-4-4">-->
          <!--<div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y"></div></div>-->
          <!--<div class="left ml5 c-aaa">5.0</div>-->
          <!--</div>-->
          <!--<div class="right institutions-l-4-2 brp location">Wentworth Point</div>-->
          <!--</div>-->
        </div>

        <div class="sp10"></div>

        <div class="IC-ls">
          <!--<div class="IC-l">-->
            <!--<div class="home-6-ls">-->
              <!--<div class="home-6-l bb3">-->
                <!--<div class="left home-6-l-l"><img src="images/test/goods3.png" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;"></div>-->
                <!--<div class="home-6-l-c">-->
                  <!--<div class="home-6-l-c-1">-->
                    <!--<div class="left home-6-l-c-1-1 brp course">Math</div>-->
                    <!--<div class="home-6-l-c-1-2 row1">First-grade training math class</div>-->
                  <!--</div>-->
                  <!--<div class="home-6-l-c-2 c-aaa font12">20 Courses 45min for each <span class="c-violet-1">4 Classes(1 Fulled)</span></div>-->
                  <!--<div class="home-6-l-c-3 c-aaa font12 brp location2">HEIDELBERG WEST,VIC3081</div>-->
                  <!--<div class="home-6-l-c-4 c-aaa font12 ovf">-->
                    <!--<div class="left home-6-l-c-4-1 brp age">Age:3-6</div>-->
                    <!--<div class="left home-6-l-c-4-2 brp sex"></div>-->
                    <!--<div class="right c-yellow-1">A$<span class="font18">300</span></div>-->
                    <!--<div class="home-6-l-c-4-4 ovf">-->
                      <!--<div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y"></div></div>-->
                      <!--<div class="left ml5">5.0</div>-->
                    <!--</div>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->

            <!--<div class="bg-grey-1 pad15">-->
              <!--<div>First grade math class in autumn(1class)</div>-->
              <!--<div class="IC-2">-->
                <!--<div class="right IC-2-r">-->
                  <!--<div class="c-red-1 IC-2-r-1">The last 5 days</div>-->
                  <!--<div class="IC-2-r-2">Buy</div>-->
                <!--</div>-->
                <!--<div class="IC-2-c font12 c-888">-->
                  <!--<div class="row1 mt10 IC-2-c-c">Registration time：2018.09.01-2018.10.01</div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Opening hours：2018.09.01-2018.10.01</div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Teacher：Crasey </div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Enrollment：30/50</div>-->
                  <!--<div class="row1 mt10 c-yellow-1 IC-2-c-c2">-->
                    <!--<div class="IC-2-c-c2-1">Syllabus</div>-->
                    <!--<div class="IC-2-c-c2-2 brp arrowBottom4"></div>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->

            <!--<div class="bg-grey-1 pad15 mt5">-->
              <!--<div>First grade math class in autumn(1class)</div>-->
              <!--<div class="IC-2">-->
                <!--<div class="right IC-2-r">-->
                  <!--<div class="c-red-1 IC-2-r-1">The last 5 days</div>-->
                  <!--<div class="IC-2-r-2">Buy</div>-->
                <!--</div>-->
                <!--<div class="IC-2-c font12 c-888">-->
                  <!--<div class="row1 mt10 IC-2-c-c">Registration time：2018.09.01-2018.10.01</div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Opening hours：2018.09.01-2018.10.01</div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Teacher：Crasey </div>-->
                  <!--<div class="row1 mt10 IC-2-c-c">Enrollment：30/50</div>-->
                  <!--<div class="row1 mt10 c-yellow-1 IC-2-c-c2">-->
                    <!--<div class="IC-2-c-c2-1">Syllabus</div>-->
                    <!--<div class="IC-2-c-c2-2 brp arrowBottom4"></div>-->
                  <!--</div>-->
                <!--</div>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->
        </div>

        <div class="noDataS hide">
          <div class="noDataS-1 brpscn"></div>
          <div class="noDataS-2">Sorry, there is no relevant data</div>
        </div>

      </ul>
    </div>
  </div>

  <div class="noDataS2 hide">
    <div class="noDataS-1 brpscn"></div>
    <div class="noDataS-2">Sorry, The institution has been disabled.</div>
    <div class="noDataS-3" onclick="Comm.close();">Back</div>
  </div>
</section>

<script src="inc/g.js"></script>
<script src="js/md5.js"></script>
<script src="inc/dict.js"></script>
<script src="mui/js/mui.min.js"></script>

<script>
  var user = Comm.db("user");
  var pageData = { pageno: 1, totalPage: 1, ifFirst: true, businessId: Comm.query("businessId"), time: Comm.query("Time"), price: Comm.query("price"), ageLimit: Comm.query("age"), sex: Comm.query("gender"), category2: Comm.query("recruitStatusd2") };
  var inDetail = {};
  var weekArr = {0: "SUN", 1: "MON", 2: "TUE", 3: "WED", 4: "THU", 5: "FRI", 6: "SAT"};
  var courseArr = [];
  var childrenArr = [];
  var calendar_obj = [];
  Comm.db("selectClass", null);
  Comm.db("children", null);

  function pageload() {
    GDict.load(function () {
      mui.init({
        pullRefresh: {
          container: "#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
          up: {
            height: 50,//可选.默认50.触发上拉加载拖动距离
            auto: false,//可选,默认false.自动上拉加载一次
            contentrefresh: "loading...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
            contentnomore: "There's no more data",//可选，请求完毕若没有更多数据时显示的提醒内容；
            contentinit: "Pull up shows more",
            contentdown: "Pull up shows more",
            callback: upData //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
          }
        }
      });
      Comm.calcSection();

      mui("#listView").off('tap');

      mui("#listView").on('tap', '.IC-2-r-2', function (e) {
        e.stopPropagation();

        if (!checkIsLogin2()) {
          return;
        }

        if (childrenArr.length <= 0) {
          Comm.message("Please add children");
          return;
        }

        var classesId = $(this).attr("classesId");
        var selectCourse;
        var selectClass;
        for (var i in courseArr) {
          for (var ii in courseArr[i].classArr) {
            if (courseArr[i].classArr[ii].classesId == classesId) {
              selectCourse = courseArr[i];
              selectClass = courseArr[i].classArr[ii];
              Comm.db("selectClass", selectClass);
              break;
            }
          }
        }
        console.log(selectCourse, selectClass);

        if (selectClass.maxCount <= selectClass.curCount) {
          Comm.message("The number of applicants is full");
          return;
        }

        AJAX2.get("api/class/isSignup", {classesid: classesId}, function (data) {
          var childrenArr_l = [];

          for (var i in childrenArr) {
            var num1 = 0;
            for (var ii in data) {
              if (childrenArr[i].childid != data[ii].studentId) {
                num1++;
              }
            }
            if (data.length == num1) {
              childrenArr_l.push(childrenArr[i]);
            }
          }
          console.log(childrenArr_l);

          //判断所有孩子的性别是否符合
          var childNoFitNum = 0;
          for (var i in childrenArr_l) {
            if (selectCourse.sex != 4 && childrenArr_l[i].gender != selectCourse.sex) {
              childNoFitNum++;
            }
          }
          if (childNoFitNum == childrenArr_l.length) {
            Comm.message("children gender mismatch");
            return;
          }

          if (Comm.db("children_home" + user.customerId)) {
            var child_select = Comm.db("children_home" + user.customerId);

            //判断首页选中的孩子是否满足
            var num2 = 0;
            for (var i in childrenArr_l) {
              if (childrenArr_l[i].childid != child_select.childid) {
                num2++;
              }
            }

            if (childrenArr_l.length == num2) {
              Comm.go('selectChildren.html?classesId=' + classesId + '&sex=' + selectCourse.sex + '&ageLimit=' + selectCourse.ageLimit + '&courseId=' + selectCourse.courseId);
              return;
            }

            if (selectCourse.sex != 4 && child_select.gender != selectCourse.sex) {
              Comm.go('selectChildren.html?classesId=' + classesId + '&sex=' + selectCourse.sex + '&ageLimit=' + selectCourse.ageLimit + '&courseId=' + selectCourse.courseId);
              return;
            }

            var submitObj_l = {
              classesid: classesId,
              childid: child_select.childid,
              courseId: selectCourse.courseId,
              ageLimitArr: selectCourse.ageLimit
            };

            Comm.db("children", child_select);
            Comm.db("submitObj_l", submitObj_l);
            Comm.go("orderOrder.html");
          } else {
            Comm.go('selectChildren.html?classesId=' + classesId + '&sex=' + selectCourse.sex + '&ageLimit=' + selectCourse.ageLimit + '&courseId=' + selectCourse.courseId);
          }

        }, function(data) {
          Comm.message(data);
        })
      })

      mui("#listView").on('tap', '.IC-2-c-c2', function (e) {
        e.stopPropagation();
        $(this).parents().filter(".ICD-2s-l").find(".ICD-tables1").toggleClass("hide");
        $(this).parents().filter(".ICD-2s-l").find(".myCourse-1").toggleClass("hide");
        $($(this).find(".arrowBottom4")).toggleClass("arrowTop4");
      })

      mui("#listView").on('tap', '.institutions-l', function (e) {
        e.stopPropagation();
        Comm.go('institutionsDetail.html?businessId=' + inDetail.bus.businessId);
      })

      mui("#listView").on('tap', '.home-6-l', function (e) {
        e.stopPropagation();
        Comm.go('institutionsCourseDetail.html?courseId=' + $(this).attr("courseId"));
      })

      getInDetail();
    });
  }

  function pageresume(){

  }

  function upData() {
    getCourseList(function (flag) {
      mui('#refreshContainer').pullRefresh().endPullupToRefresh(flag);
    });
  }

  function getInDetail() {
    AJAX2.get("api/business/show", {businessid: pageData.businessId}, function (data) {
      inDetail = data;

      if (inDetail.enable == 0) {
        $(".noDataS2").removeClass("hide");
        return;
      } else {
        $(".menu1").removeClass("hide");
        $(".titlebar").removeClass("hide");
        $("#refreshContainer").removeClass("hide");
      }

      upData();
      getChildren();
      getCalendarList();

      var h = '';
      h += '<div class="institutions-l-1 pre">\
              <img src="' + config.ossroot + inDetail.ins.logo + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;">\
              <div class="institutions-l-1-1">Verified</div>\
              </div>\
              <div class="institutions-l-2 row1">' + inDetail.ins.tradingName + '</div>\
      <div class="institutions-l-3 row2">' + inDetail.ins.introduce + '</div>\
      <div class="institutions-l-4 ovf">\
              <div class="left home-6-l-c-4-4">\
              <div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y" style="width:' + (parseFloat(inDetail.bus.evaluateValue) / 5) * 100 + '%"></div></div>\
              <div class="left ml5 c-aaa">' + inDetail.bus.evaluateValue + '</div>\
              </div>\
              <div class="right institutions-l-4-2 brp location">' + inDetail.ins.addrRegSuburb + '</div>\
      </div>';
      $(".institutions-l").html(h);

    }, function(data) {
      Comm.message(data);
    })
  }

  //课程
  function getCourseList(cb) {
    AJAX2.get("api/course/list", {businessId: pageData.businessId, isHistory: 0, time: pageData.time, price: pageData.price, ageLimit: pageData.ageDict, sex: pageData.genderDict, category1: pageData.category1, category2: pageData.category2, pageno: pageData.pageno, pagesize: config.pagesize}, function (a){
      if (pageData.ifFirst == true) {
        pageData.ifFirst = false;
        pageData.totalPage = Math.ceil(a.totalCount / config.pagesize);
      }

      var data = a.data;
      var noLoadFlag;
      if (pageData.totalPage > pageData.pageno) {
        noLoadFlag = false;
        pageData.pageno++;
      } else {
        noLoadFlag = true;
      }
      data = data.splice(0, config.pagesize);

      if (data && data.length > 0) {
        $(".noDataS").addClass("hide");
        mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
      } else {
        $(".noDataS").removeClass("hide");
        mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
      }

      var courseIdsArr = [];
      for (var i in data) {
        courseIdsArr.push(data[i].courseId);
      }

      if (courseIdsArr.length > 0) {
        //是否有满排的班级
        AJAX2.get("api/class/openAndstart", {courseId: courseIdsArr.join(",")}, function (data2){
          var obj1 = {};
          obj1 = Tool.getDict(data2, "courseId");

          for (var i in data) {
            data[i].full_obj = obj1[data[i].courseId];
          }

          addCourse(data, cb, noLoadFlag);

        }, function(data) {
          Comm.message(data);
        })
      } else {
        addCourse(data, cb, noLoadFlag);
      }

    }, function(data) {
      Comm.message(data);
    })
  }

  function addCourse(data, cb, noLoadFlag) {
    var courseIdArr = [];
    for (var i in data) {
      courseIdArr.push(data[i].courseId);
      data[i].classArr = [];
    }

    if (courseIdArr.length <= 0) {
      return;
    }

    //获取所有课程的班级
    AJAX2.get("api/class/classList", {ids: courseIdArr.join(",")}, function (data2){
      for (var i in data2) {
        data2[i].dataArr = [];
      }

      for (var i in data2) {
        for (var ii in data) {
          if (data2[i].courseId == data[ii].courseId) {
            data[ii].classArr.push(data2[i]);
          }
        }
      }

//      console.log(data);

      var classesArr = [];
      for (var i in data2) {
        classesArr.push(data2[i].classesId);
      }

      if (classesArr.length > 0) {
        //获取所有班级的排课
        AJAX2.get("api/class/listClassesPlan", { classesid: classesArr.join(",") }, function (data3) {
          for (var i in data3) {
            for (var ii in data) {
              for (var iii in data[ii].classArr) {
                if (data3[i].classesId == data[ii].classArr[iii].classesId) {
                  data[ii].classArr[iii].dataArr.push(data3[i]);
                }
              }
            }
          }

          console.log(data);

          addCourse2(data, cb, noLoadFlag);

        }, function (data) {
          Comm.message(data);
        })
      } else {
        addCourse2(data, cb, noLoadFlag);
      }

    }, function(data) {
      Comm.message(data);
    })
  }

  function addCourse2(data, cb, noLoadFlag) {
    var h = '';
    for (var i in data) {
      h += '<div class="IC-l">';
      h += '<div class="home-6-l" courseId="' + data[i].courseId + '">\
                  <div class="left home-6-l-l"><img src="' + config.ossroot + data[i].face + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;"></div>\
                  <div class="home-6-l-c">\
                  <div class="home-6-l-c-1">\
                  <div class="left home-6-l-c-1-1">' + GDict.getItem(data[i].category2).dictname + '</div>\
                  <div class="home-6-l-c-1-2 row1">' + data[i].courseName + '</div>\
                  </div>\
                    <div class="home-6-l-c-2 c-aaa font12 row1">' + data[i].lessons + ' Courses &nbsp;&nbsp;' + data[i].periods + 'min for each ' + '<span class="c-violet-1">' + (data[i].full_obj ? parseInt(data[i].full_obj.signupcount) : '0') + ' Classes' + (data[i].full_obj && data[i].full_obj.full_count != 0 ? '(' + data[i].full_obj.full_count + ' Fulled)' : '') + '</span><span class="home-6-l-c-2-hot brp hot' + (data[i].full_obj && data[i].full_obj.newestcount > 0 ? '' : ' hide') + '"></span></div>\
                    <div class="home-6-l-c-5 ovf">\
                        <div class="left home-6-l-c-4-4 ovf">\
                        <div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y" style="width:' + (data[i].evaluateValue / 5) * 100 + '%"></div></div>\
                        <div class="left ml5 c-aaa">' + data[i].evaluateValue + '</div>\
                        </div>\
                        <div class="left c-yellow-1 ml15">A$<span class="font18">' + data[i].price + '</span></div>\
                    </div>\
                    <div class="home-6-l-c-3 c-aaa font12 brp location2 row1">' + data[i].subur + ' ' + GDict.getName(data[i].territory) + '</div>\
                    <div class="home-6-l-c-4 c-aaa font12 ovf bt3">\
                      <div class="home-6-l-c-4-1 brp age mt5">Age:' + GDict.getItem(data[i].ageLimit).dictname + '</div>\
                      <div class="home-6-l-c-4-1 brp' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' sex'))) + '">Gender:' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' No screening'))) + '</div>\
                        </div>\
                        </div>\
                        </div>' + addClassHtml(data[i]);
    }
    h += '</div>';
    $(".IC-ls").append(h);

    courseArr = courseArr.concat(data);

    cb && cb(noLoadFlag);

    //设置可以水平滑动
    mui('.ICD-tables2').scroll({
      scrollY: false, //是否竖向滚动
      scrollX: true, //是否横向滚动
      startX: 0, //初始化时滚动至x
      startY: 0, //初始化时滚动至y
      indicators: false, //是否显示滚动条
      deceleration:0.0006, //阻尼系数,系数越小滑动越灵敏
      bounce: true //是否启用回弹
    });
  }

  //添加班级
  function addClassHtml(data) {
//    console.log(data);

    var h = '';
    for (var i in data.classArr) {
      h += '<div class="ICD-2s-l bg-grey-1 pad15' + (parseInt(i) == 0 ? '' : ' mt5') + '">\
              <div>' + data.classArr[i].name + '</div>\
      <div class="IC-2">\
              <div class="right IC-2-r">\
              <div class="c-red-1 IC-2-r-1">' + (CommonFunction.timeFormat4(data.classArr[i].endEnroll) >= 0 ? ('The last ' + (CommonFunction.timeFormat4(data.classArr[i].endEnroll) + 1) + ' days') : ('')) + '</div>\
      <div class="IC-2-r-2' + (data.classArr[i].curCount == data.classArr[i].maxCount ? (' IC-2-r-2-grey') : ('')) + '" classesId="' + data.classArr[i].classesId +  '">Buy</div>\
              </div>\
              <div class="IC-2-c font12 c-888">\
              <div class="row1 mt10 IC-2-c-c">Registration time：' + data.classArr[i].startEnroll.replace(/-/g, '.') + '-' + data.classArr[i].endEnroll.replace(/-/g, '.') + '</div>\
      <div class="row1 mt10 IC-2-c-c">Opening hours：' + data.classArr[i].startDate.replace(/-/g, '.') + '-' + data.classArr[i].endDate.replace(/-/g, '.') + '</div>\
      <div class="row1 mt10 IC-2-c-c">Teacher：' + data.classArr[i].teacher + '</div>\
      <div class="row1 mt10 IC-2-c-c">Enrollment：' + data.classArr[i].curCount + '/' + data.classArr[i].maxCount + '</div>\
      <div class="row1 mt10 c-yellow-1 IC-2-c-c2">\
              <div class="IC-2-c-c2-1">Syllabus</div>\
              <div class="IC-2-c-c2-2 brp arrowBottom4"></div>\
              </div>\
              </div>\
              </div>\
              \
              <div class="ICD-tables1 font12 tac c-666 hide pre">\
                <div class="ICD-tables2 mui-scroll">' + datePush(data.classArr[i]) + '</div>\
                </div>\
                <div class="ovf myCourse-1 calendar hide">\
              <div class="myCourse-2 mr20">\
              <div class="bg-blue-1 myCourse-3"></div>\
              <div class="myCourse-4">HOLIDAY</div>\
              </div>\
              <div class="myCourse-2">\
              <div class="bg-pink-1 myCourse-3"></div>\
              <div class="myCourse-4">STATUTORY</div>\
              </div>\
              </div>\
              </div>';
    }
    return h;
  }

  //排课时间
  function datePush(data) {
//    console.log(data);
    data.dataArr2 = {};
    for (var i in data.dataArr) {
      if (!data.dataArr2[data.dataArr[i].classesDate]) {
        data.dataArr2[data.dataArr[i].classesDate] = [];
      }
      data.dataArr2[data.dataArr[i].classesDate].push(data.dataArr[i]);
    }

//    console.log(data);

    var h = '<table class="ICD-table">\
            <tr>\
            <td class="ICD-table-td1"></td>';
    for (var i in data.dataArr2) {
      h += '<td class="' + (calendar_obj[data.dataArr2[i][0].classesDate] ? (calendar_obj[data.dataArr2[i][0].classesDate].isSummerVacation == 0 ? ('bg-blue-1') : ('bg-pink-1')) : ('')) + '">\
              <div>' + weekArr[new Date(data.dataArr2[i][0].classesDate).getDay()] + '</div>\
              <div>' + CommonFunction.timeFormat(new Date(data.dataArr2[i][0].classesDate).getTime(), 'MM-dd') + '</div>\
            </td>';
    }
    h += '</tr>\
            <tr>\
            <td class="ICD-table-td1">\
            <div>AM</div>\
            <div>' + data.amTime + '</div>\
    </td>';

    var h_l = [];
    for (var i in data.dataArr2) {
      h_l = [];
      for (var ii in data.dataArr2[i]) {
        h_l.push(data.dataArr2[i][ii].periodType == 1 ? '<td class="brp Course2"></td>' : '<td></td>');
      }
      h += h_l.indexOf('<td class="brp Course2"></td>') >= 0 ? '<td class="brp Course2"></td>' : '<td></td>';
    }
    h += '</tr>\
            <tr>\
            <td class="ICD-table-td1">\
            <div>PM</div>\
            <div>' + data.pmTime + '</div>\
    </td>';
    for (var i in data.dataArr2) {
      h_l = [];
      for (var ii in data.dataArr2[i]) {
        h_l.push(data.dataArr2[i][ii].periodType == 2 ? '<td class="brp Course2"></td>' : '<td></td>');
      }
      h += h_l.indexOf('<td class="brp Course2"></td>') >= 0 ? '<td class="brp Course2"></td>' : '<td></td>';
    }
    h += '</tr>\
            </table>';
    return h;
  }

  //得到小孩
  function getChildren() {
    if (!user) {
      return;
    }

    AJAX2.get("api/child/list", {customerid: user.customerId}, function (data){
      childrenArr = data;

    }, function(data) {
      Comm.message(data);
    })
  }

  //节假日
  function getCalendarList() {
    var calendarArr = [];

    AJAX2.get("api/calendar/list", {year: new Date().getFullYear(), areaId: Comm.db("district").dictid}, function (data){
      calendarArr = calendarArr.concat(data);

      AJAX2.get("api/calendar/list", {year: new Date().getFullYear() + 1, areaId: Comm.db("district").dictid}, function (data2){
        calendarArr = calendarArr.concat(data2);
        for (var i in calendarArr) {
          calendarArr[i].date = calendarArr[i].year + "-" + calendarArr[i].monthDay.slice(0, 2) + "-" + calendarArr[i].monthDay.slice(2, 4);
        }
        calendar_obj = Tool.getDict(calendarArr, "date");
        console.log(calendar_obj);

      }, function(data) {
        Comm.message(data);
      })

    }, function(data) {
      Comm.message(data);
    })
  }
</script>
</body>
</html>
