<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Cache-Control" content="public">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="renderer" content="webkit">
  <meta name="description" content="All About Children">
  <meta name="keywords" content="All About Children">
  <link rel="stylesheet" href="mui/css/mui.min.css">
  <link rel="stylesheet" href="inc/g.css" type="text/css">
  <link rel="stylesheet" href="css/common.css" type="text/css">
  <link rel="stylesheet" href="css/unique.css" type="text/css">
  <link rel="stylesheet" href="side/side.css" type="text/css">
  <script src="js/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="js/common.js"></script>
  <style>
    #box>ul>li{
      height: 50vw;
    }
    body > footer {
      overflow: initial;
    }

    .testPay{
      width: 100px;
      height:100px;
      background-color:green;
      position:absolute;
      top:0px;
      left:0px;
      z-index: 200;
      text-align:center;
      color:white;
      line-height:100px;
    }
    .gotestPay{
      width: 100px;
      height:100px;
      background-color:green;
      position:absolute;
      top:0px;
      left:100px;
      z-index: 200;
      text-align:center;
      color:white;
      line-height:100px;
    }
  </style>
</head>
<body>
<header class="bb0">
  <div class="home-t bt4">
    <div class="left home-t-1 brp location" onclick="jsGo(1)"></div>
    <div class="left home-t-2" onclick="jsGo(1)">
      <span class="home-t-2-1" style="max-width: 55px;overflow: hidden;height:50px;"></span><span class="home-t-2-2 arrowBottom2 brp"></span>
    </div>
    <div class="right home-t-4 message1 brp pre" onclick="jsGo(2)"><div class="message-red hide"></div></div>
    <div class="home-t-3 brp search" onclick="Comm.go('search.html')">KEYWORD</div>
  </div>
</header>

<!--<div class="testPay" onclick="Comm.go('https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&token=EC-54738695LL075080H')">testPay</div>-->
<!--<div class="gotestPay" onclick="Comm.go('testPay.html')">gotestPay</div>-->

<section class="pre">
  <div id="refreshContainer" class="mui-content mui-scroll-wrapper">
    <div class="mui-scroll">
      <!--数据列表-->
      <ul class="mui-table-view mui-table-view-chevron" id="listView">

        <div class="home-1-ls bg-grey-1 ovf">
          <!--<div class="home-1-l">Activities</div>-->
          <!--<div class="home-1-l">Activities</div>-->
          <!--<div class="home-1-l">ActivitiesActivitiesActivitiesActivities</div>-->
          <!--<div class="home-1-l">Activities</div>-->
        </div>

        <div>
          <div class="home-2 pre">
            <div class="left fwb font16">Curricula-variable</div>
            <div class="home-2-1 ovf" id="selectChildren">
              <div class="home-2-1-c-1 row1">No screening</div>
              <div class="home-2-1-c-2 tran brp"></div>
            </div>
          </div>
          <div class="home-3">
            <div id="box">
              <ul></ul>
            </div>
          </div>
          <div class="ovf home-4-ls">
            <div class="home-4-l brp Hottopics" type="1">Hot topics</div>
            <div class="home-4-l brp Notice" type="2">What's on</div>
            <div class="home-4-l brp Whatson" type="3">Notice</div>
          </div>
        </div>

        <div class="sp5"></div>

        <div class="ovf home-5">
          <div class="home-5-c brp home-5-c-active" type="1">Hot courses</div>
          <div class="home-5-c brp" type="2">Hot institutions</div>
        </div>

        <div class="home-6-ls">
          <!--<div class="home-6-l bb3">-->
          <!--<div class="left home-6-l-l"><img src="images/test/goods2.jpg" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;"></div>-->
          <!--<div class="home-6-l-c">-->
          <!--<div class="home-6-l-c-1">-->
          <!--<div class="left home-6-l-c-1-1 brp course">Math</div>-->
          <!--<div class="home-6-l-c-1-2 row1">First-grade training math class</div>-->
          <!--</div>-->
          <!--<div class="home-6-l-c-2 c-aaa font12">20 Courses 45min for each <span class="c-violet-1">4 Classes(1 Fulled)</span></div>-->
          <!--<div class="home-6-l-c-3 c-aaa font12 brp location2">HEIDELBERG WEST,VIC3081</div>-->
          <!--<div class="home-6-l-c-4 c-aaa font12 ovf">-->
          <!--<div class="left home-6-l-c-4-1 brp age">Age:3-6</div>-->
          <!--<div class="left home-6-l-c-4-2 brp sex"></div>-->
          <!--<div class="right c-yellow-1">A$<span class="font18">300</span></div>-->
          <!--<div class="home-6-l-c-4-4 ovf">-->
          <!--<div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y"></div></div>-->
          <!--<div class="left ml5">5.0</div>-->
          <!--</div>-->
          <!--</div>-->
          <!--</div>-->
          <!--</div>-->
        </div>

        <div class="institutions-ls">
          <!--<div class="institutions-l" onclick="Comm.go('institutionsDetail.html')">-->
          <!--<div class="institutions-l-1 pre">-->
          <!--<img src="images/test/goods2.jpg" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;">-->
          <!--<div class="institutions-l-1-1">Here</div>-->
          <!--</div>-->
          <!--<div class="institutions-l-2">Here is the name of the organization</div>-->
          <!--<div class="institutions-l-3 row2">We have not reviewed, and cannot review, all of the material, including computer software including computer</div>-->
          <!--<div class="institutions-l-4 ovf">-->
          <!--<div class="left institutions-l-4-1 c-violet-1 brp bbmm">10 x</div>-->
          <!--<div class="left home-6-l-c-4-4">-->
          <!--<div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y"></div></div>-->
          <!--<div class="left ml5 c-aaa">5.0</div>-->
          <!--</div>-->
          <!--<div class="right institutions-l-4-2 brp location">Wentworth Point</div>-->
          <!--</div>-->
          <!--</div>-->
        </div>

        <div class="noDataS hide">
          <div class="noDataS-1 brpscn" style="margin-top: 50px;"></div>
          <div class="noDataS-2" style="margin-bottom: 50px;">Sorry, there is no relevant data</div>
        </div>

      </ul>
    </div>
  </div>
</section>

<div class="app-window1 hide" onclick="openWindow(0)"></div>

<div class="children-window hide">
  <div class="children-lss">
    <div class="children-ls">
      <!--<div class="children-l row1">111</div>-->
      <!--<div class="children-l row1">222</div>-->
    </div>
  </div>
</div>

<footer>
  <ul>
    <li class="index1-1">Home</li>
    <li class="index2-0" onclick="window.location.href='searchCourse.html'">Search</li>
    <li class="index3-0 pre" onclick="window.location.href='myCourse.html'"><div class="index-search brp"><div class="index-search2 brp"></div></div></li>
    <li class="index4-0" onclick="window.location.href='forum.html'">Forum</li>
    <li class="index5-0" onclick="window.location.href='mine.html'">My</li>
  </ul>
</footer>

<script src="inc/g.js"></script>
<script src="js/md5.js"></script>
<script src="inc/dict.js"></script>
<script src="side/side.js"></script>
<script src="mui/js/mui.min.js"></script>

<script>
  var user = Comm.db("user");
  var pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
  var bannerSide;
  var adArr = [];
  var adList;
  var childrenArr = [];
  var children;
  var district;
  Comm.db("selectClass", null);
  Comm.db("children", null);
  Comm.db("submitObj_l", null);
  Comm.db("coupon_code", null);

  function pageload() {
    GDict.load(function () {
      if (!Comm.db("district")) {
        Comm.db("district", {dictid: 10});
        district = {dictid: 10};
        $(".home-t-2-1").html(GDict._data.state[0].dictname);
      } else {
        district = Comm.db("district");
        if ($(".home-t-2-1").html() != GDict.getName(district.dictid)) {
          $(".home-t-2-1").html(GDict.getName(district.dictid));
        }
      }

      mui.init({
        pullRefresh: {
          container: "#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
          down: {
            height: 50,//可选,默认50.触发下拉刷新拖动距离,
            auto: false,//可选,默认false.首次加载自动下拉刷新一次
            contentdown: "Drop down to refresh",//可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
            contentover: "Release refresh immediately",//可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
            contentrefresh: "loading...",//可选，正在刷新状态时，下拉刷新控件上显示的标题内容
            callback: downData //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
          },
          up: {
            height: 50,//可选.默认50.触发上拉加载拖动距离
            auto: false,//可选,默认false.自动上拉加载一次
            contentrefresh: "loading...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
            contentnomore: "There's no more data",//可选，请求完毕若没有更多数据时显示的提醒内容；
            contentinit: "Pull up shows more",
            contentdown: "Pull up shows more",
            callback: upData //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
          }
        }
      });
      Comm.calcSection();

      mui("#listView").off('tap');

      mui("#listView").on('tap', '.home-5-c', function (e) {
        e.stopPropagation();
        changeTheme1($(this).attr("type"));
      })

      mui("#listView").on('tap', '.home-6-l', function (e) {
        e.stopPropagation();
        Comm.go('institutionsCourseDetail.html?courseId=' + $(this).attr("courseId"));
      })

      mui("#listView").on('tap', '.institutions-l', function (e) {
        e.stopPropagation();
        Comm.go('institutionsDetail.html?businessId=' + $(this).attr("businessId"));
      })

      mui("#listView").on('tap', '.home-2', function (e) {
        e.stopPropagation();

        if (!checkIsLogin2()) {
          return;
        }

        if (childrenArr.length <= 0) {
          Comm.message("Please add children");
          return;
        }

        $(".children-window").toggleClass("hide");
        $(".app-window1").toggleClass("hide");
//        Comm.go('selectChildren2.html');
      })

      mui("#listView").on('tap', '.home-4-l', function (e) {
        e.stopPropagation();
        var type = $(this).attr("type");
        if (type == 1) {
          Comm.go('hot_Topics.html');
        } else if (type == 2) {
          Comm.go('institutions.html');
        } else if (type == 3) {
          Comm.go('commonArticle.html?aid=' + 35 + '&text=' + encodeURI('Notice'));
        }
      })

      //1:机构 2:课程 3:文章
      mui("#listView").on('tap', '.ad-fullImg', function (e) {
        e.stopPropagation();
        var adtype = $(this).attr("adType");
        var itemID = $(this).attr("itemID");
        var advertID = $(this).attr("advertID");

        if (itemID && itemID > 0) {
          if (adtype == 1) {
            Comm.go("institutionsDetail.html?businessId=" + itemID);
          } else if (adtype == 2) {
            Comm.go("institutionsCourseDetail.html?courseId=" + itemID);
          } else if (adtype == 3) {
            Comm.go("articleDetail.html?aid=" + itemID);
          }
        } else {
          Comm.go("banner.html?advertID=" + advertID);
        }
      })

      mui("#listView").on('tap', '.home-1-l', function (e) {
        e.stopPropagation();
        Comm.go('search.html?keywordId=' + $(this).attr("keywordId") + '&keyword=' + $(this).attr("keyword"));
      })

//      mui("#listView").on('tap', '.children-l', function (e) {
//        e.stopPropagation();
//        openWindow(0);
//
//        console.log($(this).html());
//
//        if ($(this).html() == "No screening") {
//          $(".home-2-1-c-1").html("No screening");
//          pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
//          $(".home-6-ls").html("");
//          $(".institutions-ls").html("");
//          $(".home-5-c").removeClass("home-5-c-active");
//          $($(".home-5-c")[0]).addClass("home-5-c-active");
//          Comm.db("children_home" + user.customerId, null);
//          children = null;
//          upData();
//          return;
//        }
//
//        for (var i in childrenArr) {
//          if (childrenArr[i].childid == $(this).attr("childid")) {
//            children = childrenArr[i];
//            if ($(".home-2-1-c-1").html() == "No screening" || $(".home-2-1-c-1").html() != children.name) {
//              $(".home-2-1-c-1").html(children.name);
//              pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
//              $(".home-6-ls").html("");
//              $(".institutions-ls").html("");
//              $(".home-5-c").removeClass("home-5-c-active");
//              $($(".home-5-c")[0]).addClass("home-5-c-active");
//              Comm.db("children_home" + user.customerId, children);
//              upData();
//            }
//            break;
//          }
//        }
//      })

      getAd();
      getLabel();
      getChildren();
      getMessCount();

//      Comm.position(function (data) {
//        console.log(data);
//        alert(JSON.stringify(data), function() {});
//      });
    });
  }

  function pageresume() {
    var changeFlag = 0;

//    if (Comm.db("children2")) {
//      children = Comm.db("children2");
//      if ($("#selectChildren").html() == "No screening" || $("#selectChildren").html() != children.name) {
//        $("#selectChildren").html(children.name);
//        changeFlag = 1;
//      }
//    }

    if (Comm.db("district")) {
      district = Comm.db("district");
      if ($(".home-t-2-1").html() != GDict.getName(district.dictid)) {
        $(".home-t-2-1").html(GDict.getName(district.dictid));
        changeFlag = 1;
      }
    }

    if (changeFlag == 1) {
      pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
      upData();
      $(".home-6-ls").html("");
      $(".institutions-ls").html("");
      $(".home-5-c").removeClass("home-5-c-active");
      $($(".home-5-c")[0]).addClass("home-5-c-active");
    }
    bannerSide.r(adList);

    getMessCount();
  }

  //下拉
  function downData() {
    pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
    adArr = [];
    bannerSide.r(adList);
    getAd();
    getLabel();
    upData();
    $(".home-6-ls").html("");
    $(".institutions-ls").html("");
    $(".home-5-c").removeClass("home-5-c-active");
    $($(".home-5-c")[0]).addClass("home-5-c-active");
    setTimeout(function () {
      mui('#refreshContainer').pullRefresh().endPulldownToRefresh();
      mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
    }, 1000);
  }

  //上拉
  function upData() {
    if (pageData.type == 1) {
      getCourseList(function (flag) {
        mui('#refreshContainer').pullRefresh().endPullupToRefresh(flag);
      });
    } else if (pageData.type == 2) {
      getInstitutionList(function (flag) {
        mui('#refreshContainer').pullRefresh().endPullupToRefresh(flag);
      });
    }
  }

  //切换标题
  function changeTheme1(t) {
    if (pageData.type == t) {
      return;
    }

    pageData.pageno = 1;
    pageData.totalPage = 1;
    pageData.ifFirst = true;
    pageData.type = t;
    $(".home-6-ls").html("");
    $(".institutions-ls").html("");
    $(".home-5-c").removeClass("home-5-c-active");
    $(event.target).addClass("home-5-c-active");
    mui('#refreshContainer').scroll().scrollTo(0, 0);
    upData();
  }

  //标签
  function getLabel() {
    AJAX2.get("api/keyword/keywordList", {types: 1, curpage: 1, pagesize: 100}, function(data) {
      data = data.sort(CommonFunction.compare('sort'));

      var h = '';
      for (var i in data) {
        h += '<div class="home-1-l" keywordId="' + data[i].keywordId + '" keyword="' + encodeURI(data[i].value) + '">' + data[i].value + '</div>';
      }
      $(".home-1-ls").html(h);

    }, function(data) {
      Comm.message(data);
    })
  }

  //广告
  function getAd() {
    bannerSide && bannerSide.r("");

    AJAX2.get("api/advert/list", {postion: 49, pageno: 1, pagesize: 10}, function (data){
      console.log(data);
      adArr = data;

      adList = '';
      for (var i in data) {
        adList += '<li><img class="ad-fullImg" adType="' + data[i].adType + '" itemID="' + data[i].itemID + '" advertID="' + data[i].advertID + '" name="' + encodeURI(data[i].adname) + '" src="' + CommonFunction.getImgUrl(config.ossroot + data[i].face, "l") + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;"></li>';
      }
      $('#box>ul').html(adList);
      bannerSide = new Side('box');

    }, function(data) {
      Comm.message(data);
    })
  }

  //课程
  function getCourseList(cb) {
    AJAX2.get("api/course/list", {ishot: 1, areaid: (district ? district.dictid : ""), sex: (children ? children.gender : ""), age: (children ? children.age : ""), isHistory: 0, pageno: pageData.pageno, pagesize: config.pagesize}, function (a){
      if (pageData.ifFirst == true) {
        pageData.ifFirst = false;
        pageData.totalPage = Math.ceil(a.totalCount / config.pagesize);
      }

      var data = a.data;
      var noLoadFlag;
      if (pageData.totalPage > pageData.pageno) {
        noLoadFlag = false;
        pageData.pageno++;
      } else {
        noLoadFlag = true;
      }
      data = data.splice(0, config.pagesize);

      if (data && data.length > 0) {
        $(".noDataS").addClass("hide");
        mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
      } else {
        $(".noDataS").removeClass("hide");
        mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
      }

      var courseIdsArr = [];
      for (var i in data) {
        courseIdsArr.push(data[i].courseId);
      }

      if (courseIdsArr.length > 0) {
        AJAX2.get("api/class/openAndstart", {courseId: courseIdsArr.join(",")}, function (data2){
          var obj1 = {};
          obj1 = Tool.getDict(data2, "courseId");

          for (var i in data) {
            data[i].full_obj = obj1[data[i].courseId];
          }

          addCourse(data, cb, noLoadFlag);

        }, function(data) {
          Comm.message(data);
        })
      } else {
        addCourse(data, cb, noLoadFlag);
      }

    }, function(data) {
      Comm.message(data);
    })
  }

  function addCourse(data, cb, noLoadFlag) {
    console.log(data);

    var h = '';
    for (var i in data) {
      h += '<div class="home-6-l" courseId="' + data[i].courseId + '">\
                  <div class="left home-6-l-l"><img src="' + config.ossroot + data[i].face + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;"></div>\
                  <div class="home-6-l-c">\
                  <div class="home-6-l-c-1">\
                  <div class="left home-6-l-c-1-1">' + GDict.getItem(data[i].category2).dictname + '</div>\
                  <div class="home-6-l-c-1-2 row1">' + data[i].courseName + '</div>\
                  </div>\
                    <div class="home-6-l-c-2 c-aaa font12 row1">' + data[i].lessons + ' Courses &nbsp;&nbsp;' + data[i].periods + 'min for each ' + '<span class="c-violet-1">' + (data[i].full_obj ? parseInt(data[i].full_obj.signupcount) : '0') + ' Classes' + (data[i].full_obj && data[i].full_obj.full_count != 0 ? '(' + data[i].full_obj.full_count + ' Fulled)' : '') + '</span><span class="home-6-l-c-2-hot brp hot' + (data[i].full_obj && data[i].full_obj.newestcount > 0 ? '' : ' hide') + '"></span></div>\
                    <div class="home-6-l-c-5 ovf">\
                        <div class="left home-6-l-c-4-4 ovf">\
                        <div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y" style="width:' + (data[i].evaluateValue / 5) * 100 + '%"></div></div>\
                        <div class="left ml5 c-aaa">' + data[i].evaluateValue + '</div>\
                        </div>\
                        <div class="left c-yellow-1 ml15">A$<span class="font18">' + data[i].price + '</span></div>\
                    </div>\
                    <div class="home-6-l-c-3 c-aaa font12 brp location2 row1">' + data[i].subur + ' ' + GDict.getName(data[i].territory) + '</div>\
                    <div class="home-6-l-c-4 c-aaa font12 ovf bt3">\
                      <div class="home-6-l-c-4-1 brp age mt5">Age:' + GDict.getItem(data[i].ageLimit).dictname + '</div>\
                      <div class="home-6-l-c-4-1 brp' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' sex'))) + '">Gender:' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' No screening'))) + '</div>\
                        </div>\
                        </div>\
                        </div>\
                        <div class="sp5"></div>';
    }
    $(".home-6-ls").append(h);

    cb && cb(noLoadFlag);
  }

  //机构
  function getInstitutionList(cb) {
    AJAX2.get("api/business/list", {ishot: 1, areaid: (district ? district.dictid : ""), pageno: pageData.pageno, pagesize: config.pagesize}, function (a) {
      if (pageData.ifFirst == true) {
        pageData.ifFirst = false;
        pageData.totalPage = Math.ceil(a.totalCount / config.pagesize);
      }

      var data = a.data;
      var noLoadFlag;
      if (pageData.totalPage > pageData.pageno) {
        noLoadFlag = false;
        pageData.pageno++;
      } else {
        noLoadFlag = true;
      }
      data = data.splice(0, config.pagesize);

      if (data && data.length > 0) {
        $(".noDataS").addClass("hide");
        mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
      } else {
        $(".noDataS").removeClass("hide");
        mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
        return;
      }

      var idsArr = [];
      for (var i in data) {
        idsArr.push(data[i].businessId);
      }

      AJAX2.get("api/business/enrolmentClasses", {ids: idsArr.join(",")}, function (data2) {
        var obj1 = Tool.getDict(data2, "businessId");
        for (var i in data) {
          if (obj1[data[i].businessId]) {
            data[i].count_obj = obj1[data[i].businessId];
          } else {
            data[i].count_obj = {count: 0};
          }
        }
        console.log(data);

        var h = '';
        for (var i in data) {
          h += '<div class="institutions-l" businessId="' + data[i].businessId + '">\
          <div class="institutions-l-1 pre">\
                  <img src="' + config.ossroot + data[i].logo + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;">\
                  <div class="institutions-l-1-1">Verified</div>\
                  </div>\
                  <div class="institutions-l-2 row1">' + data[i].tradingName + '</div>\
          <div class="institutions-l-3 row2">' + data[i].introduce + '</div>\
          <div class="institutions-l-4 ovf">\
                  <div class="left institutions-l-4-1 c-violet-1 brp bbmm">' + data[i].count_obj.count + '</div>\
          <div class="left home-6-l-c-4-4">\
                  <div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y" style="width:' + (parseFloat(data[i].evaluateValue) / 5) * 100 + '%"></div></div>\
                  <div class="left ml5 c-aaa">' + data[i].evaluateValue + '</div>\
                  </div>\
                  <div class="right institutions-l-4-2 brp location row1">' + data[i].addrRegSuburb + '</div>\
          </div>\
          </div>';
        }
        $(".institutions-ls").append(h);

        cb && cb(noLoadFlag);

      }, function(data) {
        Comm.message(data);
      })

    }, function(data) {
      Comm.message(data);
    })
  }

  //得到小孩
  function getChildren() {
    if (!user) {
      upData();
      return;
    }

    AJAX2.get("api/child/list", {customerid: user.customerId}, function (data){
      childrenArr = data;

      var h = '<div class="children-l row1" onclick="home_select_children()">No screening</div>';
      for (var i in data) {
        h += '<div class="children-l row1" childid="' + data[i].childid + '" onclick="home_select_children()">' + data[i].name + '</div>';
      }
      $(".children-ls").html(h);

      //设置可以水平滑动
//      mui('.children-lss').scroll({
//        scrollY: true, //是否竖向滚动
//        scrollX: false, //是否横向滚动
//        startX: 0, //初始化时滚动至x
//        startY: 0, //初始化时滚动至y
//        indicators: false, //是否显示滚动条
//        deceleration:0.0006, //阻尼系数,系数越小滑动越灵敏
//        bounce: false //是否启用回弹
//      });

      if (Comm.db("children_home" + user.customerId)) {
        children = Comm.db("children_home" + user.customerId);
        $(".home-2-1-c-1").html(children.name);
      }

      upData();

    }, function(data) {
      Comm.message(data);
    })
  }

  //得到消息数量
  function getMessCount() {
    if (!user) {
      return;
    }

    AJAX2.get("api/mess/count", {userType: 1}, function (data){
      if (data && data > 0) {
        $(".message-red").removeClass("hide");
      } else {
        $(".message-red").addClass("hide");
      }

    }, function(data) {
      Comm.message(data);
    })
  }

  //打开窗口
  function openWindow(n) {
    if (!checkIsLogin2()) {
      return;
    }

    $(".app-window1").toggleClass("hide");

    if (n == 0) {
      $(".children-window").addClass("hide");
    } else if (n == 1) {
      $(".children-window").toggleClass("hide");
    }
  }

  //选择孩子
  function home_select_children() {
    event.stopPropagation();
    openWindow(0);

    console.log($(event.target).html());

    if ($(event.target).html() == "No screening") {
      $(".home-2-1-c-1").html("No screening");
      pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
      $(".home-6-ls").html("");
      $(".institutions-ls").html("");
      $(".home-5-c").removeClass("home-5-c-active");
      $($(".home-5-c")[0]).addClass("home-5-c-active");
      Comm.db("children_home" + user.customerId, null);
      children = null;
      upData();
      return;
    }

    for (var i in childrenArr) {
      if (childrenArr[i].childid == $(event.target).attr("childid")) {
        children = childrenArr[i];
        if ($(".home-2-1-c-1").html() == "No screening" || $(".home-2-1-c-1").html() != children.name) {
          $(".home-2-1-c-1").html(children.name);
          pageData = {pageno: 1, totalPage: 1, ifFirst: true, type: 1};
          $(".home-6-ls").html("");
          $(".institutions-ls").html("");
          $(".home-5-c").removeClass("home-5-c-active");
          $($(".home-5-c")[0]).addClass("home-5-c-active");
          Comm.db("children_home" + user.customerId, children);
          upData();
        }
        break;
      }
    }
  }

  function jsGo(n) {
    if (n == 1) {
      Comm.go('district.html');
    } else if (n == 2) {
      if (!checkIsLogin2()) {
        return;
      }
      Comm.go('message.html');
    }
  }
</script>
</body>
</html>