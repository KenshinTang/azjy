<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Cache-Control" content="public" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-status-bar-style"  content="black" />
  <meta name="renderer" content="webkit">
  <meta name="description" content="All About Children">
  <meta name="keywords" content="All About Children">
  <link rel="stylesheet" href="mui/css/mui.min.css">
  <link rel="stylesheet" href="inc/g.css" type="text/css">
  <link rel="stylesheet" href="css/common.css" type="text/css">
  <link rel="stylesheet" href="css/unique.css" type="text/css">
  <link rel="stylesheet" href="layui-v2.2.5/css/layui.css" type="text/css">
  <script src="js/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="js/common.js"></script>
  <style>
    body > footer {
      overflow: initial;
    }
    .layui-laydate .layui-this {
      background-color: #68AF47 !important;
      color: #fff !important;
    }
    .layui-this div{
      color:white;
    }
    .layui-laydate-main{
      width:100% !important;
    }
    .layui-laydate-header {
      border-bottom: 0px !important;
    }
    .layui-laydate, .layui-laydate-hint {
      border: 0px !important;
      box-shadow: 0 0 0 !important;
    }
  </style>
</head>
<body>
<header>
  <div class="menu1" style="width:90px;">
    <div class="menu1-c brp location3" onclick="Comm.goMap('a')"></div>
    <div class="menu1-c brp search2" onclick="Comm.go('search.html')"></div>
  </div>
  <div class="titlebar" style="margin: 0px 100px;">Search</div>
  <div class="home-3" style="height:30vw;">
    <!--<img src="images/test/goods3.png" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;">-->
  </div>
  <div class="SC-1 bb3 ovf">
    <div class="SC-2">
      <div class="SC-1-c" onclick="openWindow(1, 'time')"><span class="SC-1-c-1">Time</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" onclick="openWindow(1, 'priceDictname')"><span class="SC-1-c-1">Price</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" onclick="openWindow(1, 'ageDict')"><span class="SC-1-c-1">Age</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" onclick="openWindow(1, 'genderDict')"><span class="SC-1-c-1">Gender</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" onclick="openWindow(1, 'category')"><span class="SC-1-c-1">Recruit Status</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
    </div>
  </div>

  <div class="SC-3 bg-grey-1 ovf">
    <!--<div class="SC-3-c">-->
      <!--<div class="left SC-3-c-1">3-6 year old</div>-->
      <!--<div class="left SC-3-c-2 brp delete3"></div>-->
    <!--</div>-->
  </div>
</header>

<section class="pre">
  <div id="refreshContainer" class="mui-content mui-scroll-wrapper">
    <div class="mui-scroll">
      <!--数据列表-->
      <ul class="mui-table-view mui-table-view-chevron" id="listView">

        <div class="noDataS hide">
          <div class="noDataS-1 brpscn" style="margin-top: 50px;"></div>
          <div class="noDataS-2" style="margin-bottom: 50px;">Sorry, there is no relevant data</div>
        </div>

        <div class="home-6-ls"></div>

      </ul>
    </div>
  </div>

  <!--<div class="home-6-ls">-->
    <!--<div class="home-6-l bb3">-->
      <!--<div class="left home-6-l-l"><img src="images/test/goods3.png" alt="" onerror="this.src='images/error.png';this.onerror=null;" onload="$(this).fadeTo('slow',1);" style="opacity:0;display: block;"></div>-->
      <!--<div class="home-6-l-c">-->
        <!--<div class="home-6-l-c-1">-->
          <!--<div class="left home-6-l-c-1-1 brp course">Math</div>-->
          <!--<div class="home-6-l-c-1-2 row1">First-grade training math class</div>-->
        <!--</div>-->
        <!--<div class="home-6-l-c-2 c-aaa font12">20 Courses 45min for each <span class="c-violet-1">4 Classes(1 Fulled)</span></div>-->
        <!--<div class="home-6-l-c-3 c-aaa font12 brp location2">HEIDELBERG WEST,VIC3081</div>-->
        <!--<div class="home-6-l-c-4 c-aaa font12">-->
          <!--<div class="left home-6-l-c-4-1 brp age">Age:3-6</div>-->
          <!--<div class="left home-6-l-c-4-2 brp sex"></div>-->
          <!--<div class="right c-yellow-1">A$<span class="font18">300</span></div>-->
          <!--<div class="home-6-l-c-4-4">-->
            <!--<div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y"></div></div>-->
            <!--<div class="left ml5">5.0</div>-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
    <!--</div>-->
  <!--</div>-->
</section>

<div class="app-window1 hide" onclick="openWindow(0)"></div>

<div class="searchCourse-window hide">
  <div class="SC-1 bb3 ovf">
    <div class="SC-2">
      <div class="SC-1-c" id="time" onclick="openWindow(2, 'time')"><span class="SC-1-c-1">Time</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" id="priceDictname" onclick="openWindow(2, 'priceDictname')"><span class="SC-1-c-1">Price</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" id="ageDict" onclick="openWindow(2, 'ageDict')"><div><span class="SC-1-c-1">Age</span><span class="SC-1-c-2 brp arrowBottom2"></span></div></div>
      <div class="SC-1-c" id="genderDict" onclick="openWindow(2, 'genderDict')"><span class="SC-1-c-1">Gender</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
      <div class="SC-1-c" id="category" onclick="openWindow(2, 'category')"><span class="SC-1-c-1">Recruit Status</span><span class="SC-1-c-2 brp arrowBottom2"></span></div>
    </div>
  </div>
  <div class="searchCourse-window-1 hide"></div>
  <div class="searchCourse-window-l1s hide">
    <!--<div class="searchCourse-window-l1">11</div>-->
    <!--<div class="searchCourse-window-l1">22</div>-->
    <!--<div class="searchCourse-window-l1">33</div>-->
  </div>
  <div class="searchCourse-window-2 ovf hide">
    <div class="left searchCourse-window-2-1">
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
    </div>
    <div class="searchCourse-window-2-2">
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
      <!--<div class="searchCourse-window-l1">11</div>-->
    </div>
  </div>
  <div class="searchCourse-window-3 ovf bt3 hide">
    <div class="searchCourse-window-3-1 left" onclick="Reset()">Reset</div>
    <div class="searchCourse-window-3-2 left" onclick="init()">Done</div>
  </div>
</div>

<footer>
  <ul>
    <li class="index1-0" onclick="window.location.href='home.html'">Home</li>
    <li class="index2-1">Search</li>
    <li class="index3-0 pre" onclick="window.location.href='myCourse.html'"><div class="index-search brp"><div class="index-search2 brp"></div></div></li>
    <li class="index4-0" onclick="window.location.href='forum.html'">Forum</li>
    <li class="index5-0" onclick="window.location.href='mine.html'">My</li>
  </ul>
</footer>

<script src="inc/g.js"></script>
<script src="js/md5.js"></script>
<script src="inc/dict.js"></script>
<script src="mui/js/mui.min.js"></script>
<script src="layui-v2.2.5/layui.all.js"></script>

<script>
  var user = Comm.db("user");
  var pageData = {pageno: 1, totalPage: 1, ifFirst: true, time: "", priceDictname: "", ageDict: "", genderDict: "", category1: "", category2: ""};
  var course_arr = [];

  var laydate1 = null;
  layui.use('laydate', function(){
    laydate1 = layui.laydate;
  });

  laydate1.render({
    elem: '.searchCourse-window-1', //指定元素
    type: "month",
    position: "static",
    value: "",
    showBottom: false,
    lang: "en",
    change: function(value, date, endDate){
      console.log(value); //得到日期生成的值，如：2017-08-18
      console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
      console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。

      pageData.time = value.replace(/-/g, "");
      init();
    }
  });

  function pageload() {
    mui.init({
      pullRefresh: {
        container: "#refreshContainer",//下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
        up: {
          height: 50,//可选.默认50.触发上拉加载拖动距离
          auto: false,//可选,默认false.自动上拉加载一次
          contentrefresh: "loading...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
          contentnomore: "There's no more data",//可选，请求完毕若没有更多数据时显示的提醒内容；
          contentinit: "Pull up shows more",
          contentdown: "Pull up shows more",
          callback: upData //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
        }
      }
    });
    Comm.calcSection();

    mui("#listView").off('tap');

    mui("#listView").on('tap', '.home-6-l', function (e) {
      e.stopPropagation();
      Comm.go('institutionsCourseDetail.html?courseId=' + $(this).attr("courseId"));
    })

    GDict.load(function () {
      $("ul .layui-this").removeClass("layui-this");
      getAd();
      upData();
    });
  }

  function pageresume(){

  }

  function upData() {
    getCourseList(function (flag) {
      mui('#refreshContainer').pullRefresh().endPullupToRefresh(flag);
    });
  }

  function Reset() {
    pageData.time = "";
    pageData.priceDictname = "";
    pageData.ageDict = "";
    pageData.genderDict = "";
    pageData.category1 = "";
    pageData.category2 = "";
    $("ul .layui-this").removeClass("layui-this");
    $(".searchCourse-window-l1").removeClass("c-green-1");
  }

  function init() {
    pageData.pageno = 1;
    pageData.totalPage = 1;
    pageData.ifFirst = true;
    course_arr = [];
    $(".noDataS").addClass("hide");
    $(".home-6-ls").html("");
    mui('#refreshContainer').scroll().scrollTo(0, 0);
    addLabel();
    openWindow(0);
    upData();
  }

  //课程
  function getCourseList(cb) {
    AJAX2.get("api/course/list", {time: pageData.time, price: pageData.priceDictname, ageLimit: pageData.ageDict, sex: pageData.genderDict, category1: pageData.category1, category2: pageData.category2, isHistory: 0, pageno: pageData.pageno, pagesize: config.pagesize}, function (a){
      if (pageData.ifFirst == true) {
        pageData.ifFirst = false;
        pageData.totalPage = Math.ceil(a.totalCount / config.pagesize);
      }

      var data = a.data;
      var noLoadFlag;
      if (pageData.totalPage > pageData.pageno) {
        noLoadFlag = false;
        pageData.pageno++;
      } else {
        noLoadFlag = true;
      }
      data = data.splice(0, config.pagesize);

      if (data && data.length > 0) {
        $(".noDataS").addClass("hide");
        $(".home-1-ls").addClass("hide");
        $(".search-3").addClass("hide");
        mui('#refreshContainer').pullRefresh().enablePullupToRefresh();
      } else {
        $(".noDataS").removeClass("hide");
        $(".home-1-ls").addClass("hide");
        $(".search-3").addClass("hide");
        mui('#refreshContainer').pullRefresh().disablePullupToRefresh();
      }

      var courseIdsArr = [];
      for (var i in data) {
        courseIdsArr.push(data[i].courseId);
      }

      if (courseIdsArr.length > 0) {
        AJAX2.get("api/class/openAndstart", {courseId: courseIdsArr.join(",")}, function (data2){
          var obj1 = {};
          obj1 = Tool.getDict(data2, "courseId");

          for (var i in data) {
            data[i].full_obj = obj1[data[i].courseId];
          }

          addCourse(data, cb, noLoadFlag);

        }, function(data) {
          Comm.message(data);
        })
      } else {
        addCourse(data, cb, noLoadFlag);
      }

    }, function(data) {
      Comm.message(data);
    })
  }

  function addCourse(data, cb, noLoadFlag) {
    var h = '';
    for (var i in data) {
      h += '<div class="home-6-l" courseId="' + data[i].courseId + '">\
                  <div class="left home-6-l-l"><img src="' + config.ossroot + data[i].face + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;"></div>\
                  <div class="home-6-l-c">\
                  <div class="home-6-l-c-1">\
                  <div class="left home-6-l-c-1-1">' + GDict.getItem(data[i].category2).dictname + '</div>\
                  <div class="home-6-l-c-1-2 row1">' + data[i].courseName + '</div>\
                  </div>\
                    <div class="home-6-l-c-2 c-aaa font12 row1">' + data[i].lessons + ' Courses &nbsp;&nbsp;' + data[i].periods + 'min for each ' + '<span class="c-violet-1">' + (data[i].full_obj ? parseInt(data[i].full_obj.signupcount) : '0') + ' Classes' + (data[i].full_obj && data[i].full_obj.full_count != 0 ? '(' + data[i].full_obj.full_count + ' Fulled)' : '') + '</span><span class="home-6-l-c-2-hot brp hot' + (data[i].full_obj && data[i].full_obj.newestcount > 0 ? '' : ' hide') + '"></span></div>\
                    <div class="home-6-l-c-5 ovf">\
                        <div class="left home-6-l-c-4-4 ovf">\
                        <div class="left search-goods-l-c-2-1 pre brp starl-n"><div class="search-goods-l-c-2-2 brp starl-y" style="width:' + (data[i].evaluateValue / 5) * 100 + '%"></div></div>\
                        <div class="left ml5 c-aaa">' + data[i].evaluateValue + '</div>\
                        </div>\
                        <div class="left c-yellow-1 ml15">A$<span class="font18">' + data[i].price + '</span></div>\
                    </div>\
                    <div class="home-6-l-c-3 c-aaa font12 brp location2 row1">' + data[i].subur + ' ' + GDict.getName(data[i].territory) + '</div>\
                    <div class="home-6-l-c-4 c-aaa font12 ovf bt3">\
                      <div class="home-6-l-c-4-1 brp age mt5">Age:' + GDict.getItem(data[i].ageLimit).dictname + '</div>\
                      <div class="home-6-l-c-4-1 brp' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' sex'))) + '">Gender:' + (data[i].sex == 2 ? (' boy') : (data[i].sex == 3 ? (' girl') : (' No screening'))) + '</div>\
                        </div>\
                        </div>\
                        </div>\
                        <div class="sp5"></div>';
    }
    $(".home-6-ls").append(h);

    cb && cb(noLoadFlag);
  }

  function addGreen(dict) {
    console.log(dict);

    $(event.target).parent().find("div").removeClass("c-green-1");
    $(event.target).addClass("c-green-1");
    if ($(event.target).hasClass("ageClass")) {
      pageData.ageDict = dict;
      init();
    } else if ($(event.target).hasClass("genderClass")) {
      pageData.genderDict = dict;
      init();
    } else if ($(event.target).hasClass("course_priceClass")) {
      pageData.priceDictname = dict;
      init();
    } else if ($(event.target).hasClass("category1Class")) {
      if (pageData.category1 != dict) {
        pageData.category1 = dict;
        pageData.category2 = "";
        addCategory(dict);
      }
    } else if ($(event.target).hasClass("category2Class")) {
      pageData.category2 = dict;
    }
  }

  //打开窗口
  function openWindow(n, x) {
    if (n == 0) {
      $(".app-window1").addClass("hide");
      $(".searchCourse-window").addClass("hide");
    } else if (n == 1) {
      $(".app-window1").toggleClass("hide");
      $(".searchCourse-window").toggleClass("hide");
    }

    $(".searchCourse-window .SC-1-c").removeClass("SC-1-c-active");
    $(".searchCourse-window .SC-1-c-2").removeClass("arrowTop2");

    if (x == "time") {
      $("#time").addClass("SC-1-c-active");
      $("#time .SC-1-c-2").addClass("arrowTop2");
      $(".searchCourse-window-1").removeClass("hide");
      $(".searchCourse-window-l1s").addClass("hide");
      $(".searchCourse-window-2").addClass("hide");
      $(".searchCourse-window-3").addClass("hide");
    } else if (x == "priceDictname") {
      $("#priceDictname").addClass("SC-1-c-active");
      $("#priceDictname .SC-1-c-2").addClass("arrowTop2");

      var h = '';
      for (var i in GDict._data.course_price) {
        h += '<div class="searchCourse-window-l1 course_priceClass' + (GDict._data.course_price[i].dictname == pageData.priceDictname ? ' c-green-1' : '') + '" onclick="addGreen(\'' + GDict._data.course_price[i].dictname + '\')">' + (GDict._data.course_price[i].dictname.split("-")[1] != 0 ? (GDict._data.course_price[i].dictname) : (GDict._data.course_price[i].dictname.split("-")[0] + " or more")) + '</div>';
      }

      $(".searchCourse-window-1").addClass("hide");
      $(".searchCourse-window-l1s").html(h).removeClass("hide");
      $(".searchCourse-window-2").addClass("hide");
      $(".searchCourse-window-3").addClass("hide");
    } else if (x == "ageDict") {
      $("#ageDict").addClass("SC-1-c-active");
      $("#ageDict .SC-1-c-2").addClass("arrowTop2");

      var h = '';
      for (var i in GDict._data.ageLimit) {
        h += '<div class="searchCourse-window-l1 ageClass' + (GDict._data.ageLimit[i].dictid == pageData.ageDict ? ' c-green-1' : '') + '" onclick="addGreen(\'' + GDict._data.ageLimit[i].dictid + '\')">' + GDict._data.ageLimit[i].dictname + '</div>';
      }
      $(".searchCourse-window-1").addClass("hide");
      $(".searchCourse-window-l1s").html(h).removeClass("hide");
      $(".searchCourse-window-2").addClass("hide");
      $(".searchCourse-window-3").addClass("hide");
    } else if (x == "genderDict") {
      $("#genderDict").addClass("SC-1-c-active");
      $("#genderDict .SC-1-c-2").addClass("arrowTop2");

      var h = '';
      for (var i in GDict._data.genderLimit) {
        h += '<div class="searchCourse-window-l1 genderClass' + (GDict._data.genderLimit[i].dictid == pageData.genderDict ? ' c-green-1' : '') + '" onclick="addGreen(\'' + GDict._data.genderLimit[i].dictid + '\')">' + GDict._data.genderLimit[i].dictname + '</div>';
      }
      $(".searchCourse-window-1").addClass("hide");
      $(".searchCourse-window-l1s").html(h).removeClass("hide");
      $(".searchCourse-window-2").addClass("hide");
      $(".searchCourse-window-3").addClass("hide");
    } else if (x == "category") {
      $("#category").addClass("SC-1-c-active");
      $("#category .SC-1-c-2").addClass("arrowTop2");

      var h = '';
      for (var i in GDict._data.course) {
        h += '<div class="searchCourse-window-l1 category1Class' + (GDict._data.course[i].dictid == pageData.category1 ? ' c-green-1' : '') + '" onclick="addGreen(\'' + GDict._data.course[i].dictid + '\')">' + GDict._data.course[i].dictname + '</div>';
      }

      $(".searchCourse-window-1").addClass("hide");
      $(".searchCourse-window-l1s").addClass("hide");
      $(".searchCourse-window-2").removeClass("hide");
      $(".searchCourse-window-2-1").html(h);
      $(".searchCourse-window-3").removeClass("hide");
    }
  }

  //添加二级分类
  function addCategory(dict) {
    var data = GDict.getItem(dict).cs;

    var h = '';
    for (var i in data) {
      h += '<div class="searchCourse-window-l1 category2Class' + (data[i].dictid == pageData.category2 ? ' c-green-1' : '') + '" onclick="addGreen(\'' + data[i].dictid + '\')">' + data[i].dictname + '</div>';
    }
    $(".searchCourse-window-2-2").html(h);
  }

  //删除二级分类
  function deleteProperty() {

  }

  //添加标签
  function addLabel() {
    var h = '';

    if (pageData.time != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + pageData.time.slice(0, 4) + '-' + pageData.time.slice(4, 6) + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'time\')"></div>\
              </div>';
    }

    if (pageData.priceDictname != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + (pageData.priceDictname.split("-")[1] != 0 ? (pageData.priceDictname) : (pageData.priceDictname.split("-")[0] + " or more")) + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'priceDictname\')"></div>\
              </div>';
    }

    if (pageData.ageDict != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + GDict.getItem(pageData.ageDict).dictname + ' years old' + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'ageDict\')"></div>\
              </div>';
    }

    if (pageData.genderDict != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + GDict.getItem(pageData.genderDict).dictname + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'genderDict\')"></div>\
              </div>';
    }

    if (pageData.category1 != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + GDict.getItem(pageData.category1).dictname + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'category1\')"></div>\
              </div>';
    }

    if (pageData.category2 != "") {
      h += '<div class="SC-3-c">\
              <div class="left SC-3-c-1">' + GDict.getItem(pageData.category2).dictname + '</div>\
      <div class="left SC-3-c-2 brp delete3" onclick="deleteLabel(\'category2\')"></div>\
              </div>';
    }

    $(".SC-3").html(h);
  }

  //删除标签
  function deleteLabel(s) {
    $(event.target).parent().remove();
    pageData[s] = "";
    init();
  }

  //广告
  function getAd() {
    AJAX2.get("api/advert/list", {postion: 67, pageno: 1, pagesize: 10}, function (data){
      $(".home-3").html('<img src="' + config.ossroot + data[0].face + '" alt="" onerror="this.src=\'images/error.png\';this.onerror=null;" onload="$(this).fadeTo(\'slow\',1);" style="opacity:0;display: block;" onclick="goAd(' + data[0].adType + ', ' + data[0].itemID + ')">');

    }, function(data) {
      Comm.message(data);
    })
  }

  function goAd(adtype, itemID) {
    if (adtype == 1) {
      Comm.go("institutionsDetail.html?businessId=" + itemID);
    } else if (adtype == 2) {
      Comm.go("institutionsCourseDetail.html?courseId=" + itemID);
    } else if (adtype == 3) {
      Comm.go("articleDetail.html?aid=" + itemID);
    }
  }
</script>
</body>
</html>
